"""
Export CSV after query following Neo4j.
MATCH (u) WHERE u.enabled RETURN u.name,toString(datetime({epochSeconds: ToInteger(coalesce(u.pwdlastset,0))}))

From:
SVC.SQL.0001@DOMAIN.LOCAL,2013-08-12T06:55:16Z

To:
SVC.SQL.0001@DOMAIN.LOCAL:Corp2013
SVC.SQL.0001@DOMAIN.LOCAL:Corp2013!
SVC.SQL.0001@DOMAIN.LOCAL:August2013
SVC.SQL.0001@DOMAIN.LOCAL:August2013!
"""



import sys
import csv
from datetime import datetime

def create_passwords(input_csv, corp_name=None):
    with open(input_csv, 'r', newline='') as infile:
        reader = csv.reader(infile)
        for row in reader:
            username = row[0].lower()
            date_str = row[1]

            try:
                date_obj = datetime.strptime(date_str, '%Y-%m-%dT%H:%M:%SZ')
                year = date_obj.strftime('%Y')
                month = date_obj.strftime('%B')  
            except ValueError:
                continue

            if corp_name:
                passwords = [
                    f'{corp_name}{year}', f'{corp_name}{year}!',
                    f'{month}{year}', f'{month}{year}!'
                ]
            else:
                passwords = [
                    f'{month}{year}', f'{month}{year}!'
                ]

            for password in passwords:
                print(f'{username}:{password}')

if len(sys.argv) > 1:
    input_csv = sys.argv[1]
    corp_name = sys.argv[2] if len(sys.argv) > 2 else None
    create_passwords(input_csv, corp_name)
else:
    print("Usage: python pwdchange2combolist.py <input_csv_file> [corp_name]")
